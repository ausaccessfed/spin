<%=
  breadcrumbs(
    { 'Organisations' => organisations_path },
    'Projects'
  )
%>

<%= page_header("Projects for #{@organisation.name}" ) %>

<table class="ui basic compact table">
  <thead>
    <tr>
      <th>Name</th>
      <th>AWS Account</th>
      <th>State</th>
      <th/>
    </tr>
  </thead>
  <tbody>
    <%- @projects.each do |project| -%>
      <tr>
        <td><%= project.name %></td>
        <td><%= project.aws_account %></td>
        <td><%= project.state %></td>
        <td>
          <%- if permitted?("admin:organisations:#{@organisation.id}:project_roles:read") -%>
              <%= button_link_to(organisation_project_roles_path(@organisation, project), class: 'tiny icon') do -%>
                  <%= icon_tag('lock icon') %>
                  Project Roles <em>(<%= project.project_roles.count %>)</em>
              <%- end -%>
          <%- end -%>

          <%- if permitted?("admin:organisations:#{@organisation.id}:update") -%>
            <%= button_link_to([:edit, @organisation, project], class: 'tiny icon') do -%>
              <%= icon_tag('edit') %>
              Edit
            <%- end -%>
          <%- end -%>

          <%- if permitted?("admin:organisations:#{@organisation.id}:delete") -%>
            <%= delete_button_tag([@organisation, project]) %>
          <%- end -%>
        </td>
      </tr>
    <%- end -%>
  </tbody>
</table>

<%- if permitted?("admin:organisations:#{@organisation.id}:create") -%>
  <div class="line-of-buttons">
    <%= button_link_to(new_organisation_project_path(@organisation), class: 'large green icon') do -%>
      <%= icon_tag('add') %>
      New Project
    <%- end -%>
  </div>
<%- end -%>
